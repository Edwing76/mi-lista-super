<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selecci√≥n - S√∫per List</title>
    <link rel="stylesheet" href="estilos.css">
    <link rel="manifest" href="manifest.json">

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');
  }
</script>

<style>
    /* Estilos extra para la gesti√≥n de productos */
    .item-flex {
        display: flex;
        gap: 5px;
        align-items: stretch;
    }
    .btn-delete-item {
        background: #7f1d1d;
        color: white;
        border: none;
        border-radius: 10px;
        padding: 0 15px;
        font-weight: bold;
        cursor: pointer;
    }
    .btn-item-main {
        flex-grow: 1;
    }
</style>
</head>
<body>
    <div class="app-container">
        <div id="cabecera">
            <h2 id="titulo-paso" class="main-title" style="font-size: 1.8rem;">Elije <span class="highlight">Categor√≠a</span></h2>
        </div>

        <div id="contenedor-opciones" class="button-group"></div>

        <div class="footer-controles">
            <button class="btn btn-whatsapp" onclick="location.href='lista.html'">
                VER LISTA ( <span id="contador">0</span> )
            </button>
            <button class="btn btn-secondary" onclick="location.href='index.html'">Volver al Men√∫</button>
        </div>
    </div>

    <script>
        const datosPorDefecto = {
            "üçé Fruta y Verdura": ["Patatas", "Cebollas", "Tomates", "Lechuga", "Zanahorias", "Pl√°tanos", "Manzanas", "Limones"],
            "ü•© Carne y Pescado": ["Pollo", "Ternera", "Cerdo", "Hamburguesas", "Salm√≥n", "Merluza"],
            "ü•õ L√°cteos y Huevos": ["Leche", "Huevos", "Yogures", "Queso", "Mantequilla"],
            "üçû Despensa": ["Pan de molde", "Arroz", "Pasta", "Aceite", "Sal", "Az√∫car", "Caf√©", "Legumbres"],
            "ü•§ Bebidas": ["Agua", "Coca-Cola", "Cerveza", "Vino", "Zumo"],
            "üßº Limpieza": ["Detergente", "Suavizante", "Lavavajillas", "Papel cocina", "Bolsas basura"],
            "ü™í Higiene": ["Papel Higi√©nico", "Gel de ba√±o", "Champ√∫", "Desodorante", "Pasta de dientes"]
        };

        let datos = JSON.parse(localStorage.getItem('misDatosInventario')) || datosPorDefecto;

        function guardarInventario() {
            localStorage.setItem('misDatosInventario', JSON.stringify(datos));
        }

        let listaActual = JSON.parse(localStorage.getItem('miListaS√∫per')) || [];
        actualizarContador();

        function mostrarCategorias() {
            document.getElementById('titulo-paso').innerHTML = 'Elije <span class="highlight">Categor√≠a</span>';
            const contenedor = document.getElementById('contenedor-opciones');
            contenedor.innerHTML = '';

            Object.keys(datos).forEach(cat => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.innerText = cat;
                btn.onclick = () => mostrarProductos(cat);
                contenedor.appendChild(btn);
            });

            const btnNuevaCat = document.createElement('button');
            btnNuevaCat.className = 'btn btn-secondary';
            btnNuevaCat.style.borderStyle = 'solid';
            btnNuevaCat.innerText = '‚ûï Nueva Categor√≠a';
            btnNuevaCat.onclick = () => {
                const nombre = prompt("Nombre de la nueva categor√≠a:");
                if (nombre && nombre.trim() !== "") {
                    if (!datos[nombre]) {
                        datos[nombre] = [];
                        guardarInventario();
                        mostrarCategorias();
                    }
                }
            };
            contenedor.appendChild(btnNuevaCat);
        }

        function mostrarProductos(cat) {
            document.getElementById('titulo-paso').innerHTML = `<small>Categor√≠a:</small><br>${cat}`;
            const contenedor = document.getElementById('contenedor-opciones');
            contenedor.innerHTML = '';

            const btnNuevoProd = document.createElement('button');
            btnNuevoProd.className = 'btn btn-primary';
            btnNuevoProd.innerText = '‚ûï A√±adir Producto a ' + cat;
            btnNuevoProd.onclick = () => {
                const nuevoProd = prompt(`¬øQu√© quieres a√±adir a ${cat}?`);
                if (nuevoProd && nuevoProd.trim() !== "") {
                    datos[cat].push(nuevoProd.trim());
                    guardarInventario();
                    mostrarProductos(cat);
                }
            };
            contenedor.appendChild(btnNuevoProd);

            datos[cat].forEach((prod, index) => {
                const div = document.createElement('div');
                div.className = 'item-flex';

                const btnItem = document.createElement('button');
                btnItem.className = 'btn btn-item btn-item-main';
                btnItem.innerText = prod;
                btnItem.onclick = () => guardarYVolver(prod, cat);

                const btnBorrar = document.createElement('button');
                btnBorrar.className = 'btn-delete-item';
                btnBorrar.innerText = '‚úï';
                btnBorrar.onclick = () => eliminarProductoDelInventario(cat, index);

                div.appendChild(btnItem);
                div.appendChild(btnBorrar);
                contenedor.appendChild(div);
            });

            const btnVolver = document.createElement('button');
            btnVolver.className = 'btn btn-secondary';
            btnVolver.innerText = '‚¨Ö Volver a Categor√≠as';
            btnVolver.onclick = mostrarCategorias;
            contenedor.appendChild(btnVolver);
            
            window.scrollTo(0, 0);
        }

        function eliminarProductoDelInventario(cat, index) {
            if (confirm("¬øEliminar este producto del cat√°logo?")) {
                datos[cat].splice(index, 1);
                guardarInventario();
                mostrarProductos(cat);
            }
        }

        function guardarYVolver(producto, categoria) {
            listaActual.push({ nombre: producto, categoria: categoria });
            localStorage.setItem('miListaS√∫per', JSON.stringify(listaActual));
            actualizarContador();
            mostrarCategorias();
        }

        function actualizarContador() {
            document.getElementById('contador').innerText = listaActual.length;
        }

        mostrarCategorias();
    </script>
</body>
</html>